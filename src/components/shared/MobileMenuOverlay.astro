---
import type { LandingDict } from "../../i18n";
import Logo from "../../assets/logo.svg";
import GitHubIcon from "./icons/GitHubIcon.astro";
import MenuToCloseIcon from "./icons/MenuToCloseIcon.astro";

interface Props {
  t: LandingDict;
  signInUrl?: string;
  githubUrl?: string;
  discordUrl?: string;
}

const { t } = Astro.props;
---

<div
  id="mobile-menu"
  data-mobile-menu-overlay
  role="dialog"
  aria-modal="true"
  aria-hidden="true"
  class="bg-background/10 invisible fixed inset-0 z-50 flex h-svh flex-col opacity-0 backdrop-blur-xl transition-all duration-300 md:hidden"
>
  <div class="flex items-center justify-end px-6 py-4">
    <button
      data-mobile-menu-close
      class="text-foreground hover:bg-muted/40 inline-flex size-9 cursor-pointer items-center justify-center rounded-full transition-colors"
      type="button"
      aria-label="Close menu"
    >
      <MenuToCloseIcon class="size-6" />
    </button>
  </div>

  <nav class="flex flex-1 flex-col px-6 pt-4">
    <a href="#product" class="mobile-menu-link py-3 text-2xl font-semibold"
      >{t.nav.product}</a
    >
    <a href="#pricing" class="mobile-menu-link py-3 text-2xl font-semibold"
      >{t.nav.pricing}</a
    >
    <a href="#faq" class="mobile-menu-link py-3 text-2xl font-semibold"
      >{t.nav.faq}</a
    >
  </nav>

  <div class="flex flex-col gap-4 px-6 pb-8">
    <a
      href="https://app.subeye.cc/auth/sign-in"
      class="mobile-menu-link py-3 text-2xl font-semibold">{t.nav.signin}</a
    >
  </div>

  <div class="flex flex-row justify-between gap-2 px-6 pb-8">
    <Logo class="h-auto w-12" />

    <div class="flex flex-row gap-1">
      <a
        href="https://github.com/yhunko/sub-eye"
        target="_blank"
        rel="noopener noreferrer"
        class="transition-transform duration-300 will-change-transform hover:scale-110"
        aria-label="GitHub link"
      >
        <GitHubIcon id="github-icon" class="size-10" />
      </a>
    </div>
  </div>
</div>

<script>
  function setupOverlay() {
    const overlay = document.querySelector("[data-mobile-menu-overlay]");
    const closeBtn = document.querySelector("[data-mobile-menu-close]");
    const links = document.querySelectorAll(".mobile-menu-link");

    if (!overlay) return;

    const setVisible = (show: boolean) => {
      if (show) {
        overlay.classList.remove("invisible", "opacity-0");
        overlay.classList.add("visible", "opacity-100");
        document.body.style.overflow = "hidden";
        overlay.setAttribute("aria-hidden", "false");

        if (closeBtn && closeBtn instanceof HTMLButtonElement) {
          closeBtn.focus();
        }
      } else {
        overlay.classList.remove("visible", "opacity-100");
        overlay.classList.add("invisible", "opacity-0");
        document.body.style.overflow = "";
        overlay.setAttribute("aria-hidden", "true");
      }
      // Notify the toggle button to update its aria state
      window.dispatchEvent(
        new CustomEvent("mobile-menu-changed", { detail: { isOpen: show } }),
      );
    };

    window.addEventListener("toggle-mobile-menu", () => {
      const isVisible = overlay.classList.contains("visible");
      setVisible(!isVisible);
    });

    closeBtn?.addEventListener("click", () => setVisible(false));
    links.forEach((link) =>
      link.addEventListener("click", () => setVisible(false)),
    );
    window.addEventListener(
      "keydown",
      (e) => e.key === "Escape" && setVisible(false),
    );
  }

  setupOverlay();
  document.addEventListener("astro:after-swap", setupOverlay);
</script>
